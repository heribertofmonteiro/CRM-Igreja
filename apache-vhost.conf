# Apache Virtual Host Configuration for ChurchCRM (Local Development)
# Copy this file to /etc/apache2/sites-available/churchcrm.local.conf
# Then run: sudo a2ensite churchcrm.local && sudo systemctl reload apache2

<VirtualHost *:80>
    ServerName churchcrm.local
    ServerAdmin webmaster@localhost
    
    # DocumentRoot - aponta para o diretório src do projeto
    DocumentRoot /home/heriberto/projetos/PHP/Laravel/CRM/src
    
    # Diretório principal
    <Directory /home/heriberto/projetos/PHP/Laravel/CRM/src>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Configurações de segurança
        <FilesMatch "\.(php|phtml)$">
            Require all granted
        </FilesMatch>
        
        # Bloquear acesso a arquivos sensíveis
        <FilesMatch "^\.">
            Require all denied
        </FilesMatch>
        
        <FilesMatch "(^Config\.php|composer\.json|composer\.lock)">
            Require all denied
        </FilesMatch>
    </Directory>
    
    # Diretórios de upload com permissões especiais
    <Directory /home/heriberto/projetos/PHP/Laravel/CRM/src/Uploads>
        Options -Indexes
        AddType application/octet-stream .php .phtml .php3 .php4 .php5
        Require all granted
    </Directory>
    
    # Logs de erro e acesso
    ErrorLog ${APACHE_LOG_DIR}/churchcrm_error.log
    CustomLog ${APACHE_LOG_DIR}/churchcrm_access.log combined
    
    # Configurações de PHP (opcional, pode ser configurado no php.ini)
    <IfModule mod_php8.c>
        php_value upload_max_filesize 10M
        php_value post_max_size 10M
        php_value memory_limit 256M
        php_value max_execution_time 300
        php_value error_reporting E_ALL & ~E_DEPRECATED & ~E_STRICT
        php_value display_errors On
        php_value log_errors On
        php_value error_log /home/heriberto/projetos/PHP/Laravel/CRM/src/logs/php-error.log
    </IfModule>
    
    # Configurações de compressão
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/plain
        AddOutputFilterByType DEFLATE text/html
        AddOutputFilterByType DEFLATE text/xml
        AddOutputFilterByType DEFLATE text/css
        AddOutputFilterByType DEFLATE application/xml
        AddOutputFilterByType DEFLATE application/xhtml+xml
        AddOutputFilterByType DEFLATE application/rss+xml
        AddOutputFilterByType DEFLATE application/javascript
        AddOutputFilterByType DEFLATE application/x-javascript
    </IfModule>
    
    # Configurações de cache
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresByType text/css "access plus 1 month"
        ExpiresByType application/javascript "access plus 1 month"
        ExpiresByType image/png "access plus 1 month"
        ExpiresByType image/jpg "access plus 1 month"
        ExpiresByType image/jpeg "access plus 1 month"
        ExpiresByType image/gif "access plus 1 month"
        ExpiresByType image/ico "access plus 1 month"
        ExpiresByType image/icon "access plus 1 month"
        ExpiresByType text/html "access plus 1 hour"
    </IfModule>
    
    # Security headers
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options SAMEORIGIN
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Remover assinatura do servidor
    ServerSignature Off
    ServerTokens Prod
</VirtualHost>

# Configuração para HTTPS (opcional)
# <VirtualHost *:443>
#     ServerName churchcrm.local
#     ServerAdmin webmaster@localhost
#     
#     DocumentRoot /home/heriberto/projetos/PHP/Laravel/CRM/src
#     
#     # SSL Configuration
#     SSLEngine on
#     SSLCertificateFile /etc/ssl/certs/churchcrm-local.crt
#     SSLCertificateKeyFile /etc/ssl/private/churchcrm-local.key
#     
#     # Outras configurações são as mesmas do HTTP
#     
#     # Security headers for HTTPS
#     Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
# </VirtualHost>
